<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>團體訂餐費用分攤計算器</title>
    <style>
        :root {
            --primary-color: #4682B4;
            --yellow: #FFFF00;
            --light-blue: #A8D7E0;
            --orange: #FFA500;
            --green: #90EE90;
            --border-color: #ccc;
            --header-bg: #f2f2f2;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding-bottom: 60px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 1.8rem;
        }
        
        .toolbar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #3A6B99;
        }
        
        .calculator-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .section-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            font-weight: bold;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
        }
        
        th {
            background-color: var(--header-bg);
            position: sticky;
            top: 0;
        }
        
        input, select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .yellow-bg {
            background-color: var(--yellow);
        }
        
        .light-blue-bg {
            background-color: var(--light-blue);
        }
        
        .orange-bg {
            background-color: var(--orange);
        }
        
        .green-bg {
            background-color: var(--green);
        }
        
        .total-row {
            font-weight: bold;
            background-color: #e6f7ff;
        }
        
        .red-text {
            color: red;
        }
        
        .item-row td {
            vertical-align: middle;
        }
        
        .add-row {
            margin: 10px 0;
            text-align: center;
        }
        
        .summary-section {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            flex: 1;
            min-width: 250px;
        }
        
        .summary-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .summary-items {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .summary-label {
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .summary-section {
                flex-direction: column;
            }
            
            .toolbar {
                flex-direction: column;
            }
            
            .toolbar button {
                width: 100%;
            }
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            padding: 10px;
            text-align: center;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            font-size: 12px;
            color: #666;
        }
        
        /* Additional styling for the remove buttons */
        .remove-btn {
            background-color: #ff4d4d;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-btn:hover {
            background-color: #ff3333;
        }
    </style>
</head>
<body>
    <header>
        <h1>團體訂餐費用分攤計算器</h1>
    </header>
    
    <div class="container">
        <div class="toolbar">
            <div>
                <button id="addPersonBtn">新增用餐人員</button>
                <button id="clearAllBtn">清除所有數據</button>
            </div>
            <div>
                <button id="calculateBtn">計算費用分攤</button>
                <button id="saveBtn">儲存數據</button>
            </div>
        </div>
        
        <div class="summary-section">
            <div class="summary-card">
                <div class="summary-title">訂單摘要</div>
                <div class="summary-items">
                    <div class="summary-item">
                        <div class="summary-label">總毛額:</div>
                        <div id="summaryGross">0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">總優惠:</div>
                        <div id="summaryDiscount" class="red-text">0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">總淨額:</div>
                        <div id="summaryNet">0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">人數:</div>
                        <div id="summaryPeople">0</div>
                    </div>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="summary-title">費用明細</div>
                <div class="summary-items">
                    <div class="summary-item">
                        <div class="summary-label">餐點總額:</div>
                        <div id="summaryFood">0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">外賣盒費:</div>
                        <div id="summaryBox">0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">配送費:</div>
                        <div id="summaryDelivery">0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">膠袋費:</div>
                        <div id="summaryBag">0.00</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="calculator-section">
            <div class="section-header">餐點明細及分攤</div>
            <div class="table-container">
                <table id="mealTable">
                    <thead>
                        <tr>
                            <th width="5%">序號</th>
                            <th width="10%">飯友</th>
                            <th class="yellow-bg" width="10%">毛付</th>
                            <th class="yellow-bg" width="10%">外賣盒</th>
                            <th class="yellow-bg" width="10%">配送費</th>
                            <th class="light-blue-bg" width="10%">商家優惠</th>
                            <th class="light-blue-bg" width="10%">膠袋費</th>
                            <th class="orange-bg" width="10%">比例</th>
                            <th width="10%">淨付</th>
                            <th width="5%">操作</th>
                        </tr>
                    </thead>
                    <tbody id="mealTableBody">
                        <!-- Default first row -->
                        <tr class="item-row" data-row-id="1">
                            <td>01</td>
                            <td><input type="text" class="person-name" value=""></td>
                            <td class="yellow-bg"><input type="number" step="0.01" class="meal-cost" value="0"></td>
                            <td class="yellow-bg"><input type="number" step="0.01" class="box-fee" value="0"></td>
                            <td class="yellow-bg"><input type="number" step="0.01" class="delivery-fee" value="0"></td>
                            <td class="light-blue-bg"><input type="number" step="0.01" class="discount" value="0"></td>
                            <td class="light-blue-bg"><input type="number" step="0.01" class="bag-fee" value="0"></td>
                            <td class="orange-bg percentage">0%</td>
                            <td class="net-pay">0.00</td>
                            <td><span class="remove-btn">×</span></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="2">總計</td>
                            <td class="yellow-bg" id="totalGross">0.00</td>
                            <td class="yellow-bg" id="totalBox">0.00</td>
                            <td class="yellow-bg" id="totalDelivery">0.00</td>
                            <td class="light-blue-bg red-text" id="totalDiscount">0.00</td>
                            <td class="light-blue-bg" id="totalBag">0.00</td>
                            <td class="orange-bg" id="totalPercentage">0%</td>
                            <td id="totalNet">0.00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="add-row">
                <button id="addRowBtn">新增一行</button>
            </div>
        </div>
        
        <div class="calculator-section">
            <div class="section-header">其他支出明細</div>
            <div class="table-container">
                <table id="expenseTable">
                    <thead>
                        <tr>
                            <th width="30%">項目</th>
                            <th width="20%">金額</th>
                            <th width="30%">備註</th>
                            <th width="20%">操作</th>
                        </tr>
                    </thead>
                    <tbody id="expenseTableBody">
                        <tr class="expense-row">
                            <td><input type="text" class="expense-name" value="商家優惠" readonly></td>
                            <td><input type="number" step="0.01" class="expense-amount" id="merchantDiscount" value="0" readonly></td>
                            <td><input type="text" class="expense-note" value="由商家提供的折扣"></td>
                            <td></td>
                        </tr>
                        <tr class="expense-row">
                            <td><input type="text" class="expense-name" value="配送費"></td>
                            <td><input type="number" step="0.01" class="expense-amount" id="deliveryFeeTotal" value="0"></td>
                            <td><input type="text" class="expense-note" value="配送費用"></td>
                            <td></td>
                        </tr>
                        <tr class="expense-row">
                            <td><input type="text" class="expense-name" value="膠袋費"></td>
                            <td><input type="number" step="0.01" class="expense-amount" id="bagFeeTotal" value="0"></td>
                            <td><input type="text" class="expense-note" value="環保膠袋費用"></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="footer">
        團體訂餐費用分攤計算器 © 2025
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize global variables
            let rowCounter = 1;
            
            // Set up event handlers
            document.getElementById('addRowBtn').addEventListener('click', addNewRow);
            document.getElementById('addPersonBtn').addEventListener('click', addNewRow);
            document.getElementById('clearAllBtn').addEventListener('click', clearAllData);
            document.getElementById('calculateBtn').addEventListener('click', calculateAll);
            document.getElementById('saveBtn').addEventListener('click', saveData);
            
            // Setup remove buttons
            setupRemoveButtons();
            
            // Setup input change handlers
            setupInputHandlers();
            
            // Add some sample data
            addSampleData();
            
            // Calculate initially
            calculateAll();
            
            function addNewRow() {
                rowCounter++;
                const tbody = document.getElementById('mealTableBody');
                const newRow = document.createElement('tr');
                newRow.className = 'item-row';
                newRow.dataset.rowId = rowCounter;
                
                // Format row number with leading zero
                const rowNum = rowCounter < 10 ? `0${rowCounter}` : rowCounter;
                
                newRow.innerHTML = `
                    <td>${rowNum}</td>
                    <td><input type="text" class="person-name" value=""></td>
                    <td class="yellow-bg"><input type="number" step="0.01" class="meal-cost" value="0"></td>
                    <td class="yellow-bg"><input type="number" step="0.01" class="box-fee" value="0"></td>
                    <td class="yellow-bg"><input type="number" step="0.01" class="delivery-fee" value="0"></td>
                    <td class="light-blue-bg"><input type="number" step="0.01" class="discount" value="0"></td>
                    <td class="light-blue-bg"><input type="number" step="0.01" class="bag-fee" value="0"></td>
                    <td class="orange-bg percentage">0%</td>
                    <td class="net-pay">0.00</td>
                    <td><span class="remove-btn">×</span></td>
                `;
                
                tbody.appendChild(newRow);
                
                // Setup the new remove button
                setupRemoveButtons();
                
                // Setup input handlers for the new row
                setupInputHandlers();
                
                // Recalculate
                calculateAll();
            }
            
            function setupRemoveButtons() {
                document.querySelectorAll('.remove-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const row = this.closest('tr');
                        if (document.querySelectorAll('.item-row').length > 1) {
                            row.remove();
                            calculateAll();
                        } else {
                            alert('必須至少保留一行');
                        }
                    });
                });
            }
            
            function setupInputHandlers() {
                document.querySelectorAll('.meal-cost, .box-fee, .delivery-fee, .discount, .bag-fee, .expense-amount').forEach(input => {
                    input.addEventListener('input', calculateAll);
                });
            }
            
            function calculateAll() {
                // Get all rows
                const rows = document.querySelectorAll('.item-row');
                
                // Initialize totals
                let totalGross = 0;
                let totalBox = 0;
                let totalDelivery = 0;
                let totalDiscount = 0;
                let totalBag = 0;
                let totalNet = 0;
                
                // Calculate each row and sum up
                rows.forEach(row => {
                    const mealCost = parseFloat(row.querySelector('.meal-cost').value) || 0;
                    const boxFee = parseFloat(row.querySelector('.box-fee').value) || 0;
                    const deliveryFee = parseFloat(row.querySelector('.delivery-fee').value) || 0;
                    const discount = parseFloat(row.querySelector('.discount').value) || 0;
                    const bagFee = parseFloat(row.querySelector('.bag-fee').value) || 0;
                    
                    // Sum up for this row
                    const gross = mealCost + boxFee + deliveryFee;
                    const net = gross - discount + bagFee;
                    
                    // Update totals
                    totalGross += gross;
                    totalBox += boxFee;
                    totalDelivery += deliveryFee;
                    totalDiscount += discount;
                    totalBag += bagFee;
                    totalNet += net;
                });
                
                // Calculate and set percentages for each row
                rows.forEach(row => {
                    const mealCost = parseFloat(row.querySelector('.meal-cost').value) || 0;
                    const boxFee = parseFloat(row.querySelector('.box-fee').value) || 0;
                    const deliveryFee = parseFloat(row.querySelector('.delivery-fee').value) || 0;
                    const discount = parseFloat(row.querySelector('.discount').value) || 0;
                    const bagFee = parseFloat(row.querySelector('.bag-fee').value) || 0;
                    
                    // Calculate net for this row
                    const gross = mealCost + boxFee + deliveryFee;
                    const net = gross - discount + bagFee;
                    
                    // Calculate percentage (avoid division by zero)
                    const percentage = totalGross > 0 ? (gross / totalGross * 100) : 0;
                    row.querySelector('.percentage').textContent = `${percentage.toFixed(1)}%`;
                    
                    // Update net pay
                    row.querySelector('.net-pay').textContent = net.toFixed(2);
                });
                
                // Update totals in footer
                document.getElementById('totalGross').textContent = totalGross.toFixed(2);
                document.getElementById('totalBox').textContent = totalBox.toFixed(2);
                document.getElementById('totalDelivery').textContent = totalDelivery.toFixed(2);
                document.getElementById('totalDiscount').textContent = `(${totalDiscount.toFixed(2)})`;
                document.getElementById('totalBag').textContent = totalBag.toFixed(2);
                document.getElementById('totalPercentage').textContent = '100%';
                document.getElementById('totalNet').textContent = totalNet.toFixed(2);
                
                // Update merchant discount in expense section
                document.getElementById('merchantDiscount').value = totalDiscount.toFixed(2);
                document.getElementById('deliveryFeeTotal').value = totalDelivery.toFixed(2);
                document.getElementById('bagFeeTotal').value = totalBag.toFixed(2);
                
                // Update summary section
                document.getElementById('summaryGross').textContent = totalGross.toFixed(2);
                document.getElementById('summaryDiscount').textContent = `(${totalDiscount.toFixed(2)})`;
                document.getElementById('summaryNet').textContent = totalNet.toFixed(2);
                document.getElementById('summaryPeople').textContent = rows.length;
                document.getElementById('summaryFood').textContent = (totalGross - totalBox - totalDelivery).toFixed(2);
                document.getElementById('summaryBox').textContent = totalBox.toFixed(2);
                document.getElementById('summaryDelivery').textContent = totalDelivery.toFixed(2);
                document.getElementById('summaryBag').textContent = totalBag.toFixed(2);
            }
            
            function clearAllData() {
                if (confirm('確定要清除所有數據嗎？此操作無法恢復。')) {
                    // Clear all rows except first one
                    const tbody = document.getElementById('mealTableBody');
                    while (tbody.childNodes.length > 1) {
                        tbody.removeChild(tbody.lastChild);
                    }
                    
                    // Reset the first row
                    const firstRow = tbody.firstChild;
                    firstRow.querySelector('.person-name').value = '';
                    firstRow.querySelector('.meal-cost').value = '0';
                    firstRow.querySelector('.box-fee').value = '0';
                    firstRow.querySelector('.delivery-fee').value = '0';
                    firstRow.querySelector('.discount').value = '0';
                    firstRow.querySelector('.bag-fee').value = '0';
                    
                    // Reset expense table
                    document.getElementById('merchantDiscount').value = '0';
                    document.getElementById('deliveryFeeTotal').value = '0';
                    document.getElementById('bagFeeTotal').value = '0';
                    
                    // Reset row counter
                    rowCounter = 1;
                    
                    // Recalculate
                    calculateAll();
                }
            }
            
            function saveData() {
                // In a real app, this would save to localStorage or server
                alert('數據已保存！在實際應用中，這會將數據保存到瀏覽器或伺服器。');
            }
            
            function addSampleData() {
                // Set data for first row
                const firstRow = document.querySelector('.item-row');
                firstRow.querySelector('.person-name').value = 'hou';
                firstRow.querySelector('.meal-cost').value = '47.00';
                firstRow.querySelector('.box-fee').value = '1.00';
                firstRow.querySelector('.delivery-fee').value = '0';
                firstRow.querySelector('.discount').value = '20.00';
                firstRow.querySelector('.bag-fee').value = '0.50';
                
                // Add second row with data
                addNewRow();
                const secondRow = document.querySelectorAll('.item-row')[1];
                secondRow.querySelector('.person-name').value = 'julia';
                secondRow.querySelector('.meal-cost').value = '23.50';
                secondRow.querySelector('.box-fee').value = '0.50';
                secondRow.querySelector('.delivery-fee').value = '0';
                secondRow.querySelector('.discount').value = '10.00';
                secondRow.querySelector('.bag-fee').value = '0.25';
                
                // Add third row with data
                addNewRow();
                const thirdRow = document.querySelectorAll('.item-row')[2];
                thirdRow.querySelector('.person-name').value = 'Karen';
                thirdRow.querySelector('.meal-cost').value = '23.50';
                thirdRow.querySelector('.box-fee').value = '0.50';
                thirdRow.querySelector('.delivery-fee').value = '0';
                thirdRow.querySelector('.discount').value = '10.00';
                thirdRow.querySelector('.bag-fee').value = '0.25';
            }
        });
    </script>
</body>
</html>
